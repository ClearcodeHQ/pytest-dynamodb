language: python
python:
    - "2.7"
    - "3.3"
    - "3.4"
    - "3.5"
    - "pypy"
    - "pypy3"
env:
- INSTALLATION="python setup.py develop" XDIST=1
- INSTALLATION="pip install ." XDIST=0
before_install:
- mkdir /tmp/dynamodb
- wget -O - http://dynamodb-local.s3-website-us-west-2.amazonaws.com/dynamodb_local_latest
  | tar xz --directory /tmp/dynamodb
install:
    - "pip install -r requirements-test.txt"
    - $INSTALLATION
    - "pip install pytest-dynamodb[tests] coveralls wheel"
script:
    - py.test -n $XDIST --cov pytest_dbfixtures tests
    - "pylama"
    - "pyroma ."
after_success:
    - coveralls

deploy:
    provider: pypi
    user: thearoom
    password:
        secure: "run travis encrypt --add deploy.password"
    on:
        tags: true
        all_branches: true
        repo: ClearcodeHQ/pytest-dynamodb
    distributions: "sdist bdist_wheel"
